# NTC温度传感器测试方案

## 项目简介

本项目使用**Keysight DAQ970A多通道数据采集仪表** + **DAQM909A 4通道同步采样模块**进行NTC（负温度系数）温度传感器的测试。

### 测试参数
- **测试时长**: 15秒
- **采样频率**: 50Hz
- **通道数**: 4通道（DAQM909A同步采样）
- **总采样点数**: 750点（15秒 × 50Hz）

## 硬件配置

### 设备清单
1. **Keysight DAQ970A** - 主数据采集单元
2. **DAQM909A** - 4通道同步采样模块（安装在DAQ970A中）
3. **NTC温度传感器** - 待测传感器（建议10kΩ@25°C）

### 连接方式
- **LAN连接**: `TCPIP0::192.168.1.100::inst0::INSTR`（推荐）
- **USB连接**: `USB0::0x2A8D::0x1301::MY12345678::INSTR`

## 软件环境

### 依赖安装
```bash
pip install -r requirements.txt
```

### 主要依赖
- `pyvisa` / `pyvisa-py` - VISA通信库
- `numpy` - 数值计算
- `matplotlib` - 数据可视化
- `scipy` - 信号处理

## 使用方法

### 1. 配置参数

编辑 `config.json` 文件，修改以下关键参数：

```json
{
  "instrument": {
    "resource_name": "TCPIP0::192.168.1.100::inst0::INSTR"  // 修改为实际IP地址
  },
  "test_parameters": {
    "duration": 15.0,      // 测试时长（秒）
    "sample_rate": 50.0,   // 采样频率（Hz）
    "channels": [101, 102, 103, 104]  // DAQM909A通道编号
  },
  "ntc_parameters": {
    "r0": 10000.0,   // NTC参考电阻（Ω）
    "t0": 25.0,      // 参考温度（°C）
    "beta": 3950.0   // Beta值（K）
  }
}
```

### 2. 运行测试

```bash
python ntc_test_daq970a.py
```

### 3. 查看结果

测试完成后会自动：
- 生成数据文件：`ntc_test_data_YYYYMMDD_HHMMSS.json`
- 生成图表文件：`ntc_test_plot_YYYYMMDD_HHMMSS.png`
- 输出日志文件：`ntc_test.log`

## 代码结构

```
.
├── ntc_test_daq970a.py    # 主测试脚本
├── data_processor.py      # 数据处理和分析模块
├── config.json            # 配置文件
├── requirements.txt       # Python依赖
└── README.md             # 本文档
```

## 功能特性

### 1. 数据采集
- ✅ 多通道同步采样（4通道）
- ✅ 可配置采样率和测试时长
- ✅ 实时数据采集和存储
- ✅ 异常处理和数据验证

### 2. 数据处理
- ✅ 异常值检测和移除
- ✅ 多种滤波算法（移动平均、中值滤波、巴特沃斯滤波）
- ✅ 统计分析和稳态检测
- ✅ 通道间相关性分析

### 3. 数据可视化
- ✅ 多通道温度曲线图
- ✅ 统计信息标注
- ✅ 高分辨率图表导出

### 4. 数据存储
- ✅ JSON格式数据保存
- ✅ 包含原始数据、处理数据和分析结果
- ✅ 时间戳和测试参数记录

## 完善建议和改进方向

### 1. 硬件配置优化

#### 当前方案
- ✅ 使用DAQM909A实现4通道同步采样
- ✅ 50Hz采样率满足大多数应用需求

#### 建议改进
1. **采样率优化**
   - 对于快速温度变化，可提高到100Hz或更高
   - 对于稳态测试，可降低到10-20Hz以节省存储空间

2. **通道扩展**
   - 如需更多通道，可添加多个DAQM909A模块
   - 或使用DAQ970A的其他插槽安装不同模块

3. **测量精度**
   - 根据NTC特性选择合适的测量范围
   - 考虑使用4线制测量提高精度（如果支持）

### 2. 软件功能增强

#### 建议添加的功能

1. **实时监控界面**
   ```python
   # 建议使用PyQt或Tkinter创建GUI
   # 实时显示温度曲线、统计信息
   # 支持参数调整和测试控制
   ```

2. **自动化测试流程**
   ```python
   # 支持批量测试
   # 测试序列配置
   # 自动生成测试报告
   ```

3. **数据对比分析**
   ```python
   # 历史数据对比
   # 多批次测试对比
   # 趋势分析
   ```

4. **温度补偿和校准**
   ```python
   # NTC参数自动校准
   # 环境温度补偿
   # 多点校准支持
   ```

5. **数据库存储**
   ```python
   # 使用SQLite或MySQL存储历史数据
   # 支持数据查询和检索
   # 数据备份和恢复
   ```

### 3. 测量精度提升

1. **NTC参数精确测量**
   - 使用多点校准确定准确的Beta值
   - 考虑使用Steinhart-Hart方程（更精确）

2. **环境补偿**
   - 测量环境温度进行补偿
   - 考虑自热效应

3. **信号处理优化**
   - 使用更高级的滤波算法
   - 自适应滤波

### 4. 测试方案扩展

1. **温度循环测试**
   ```python
   # 支持温度循环测试
   # 升温/降温速率控制
   # 温度保持时间设置
   ```

2. **多传感器对比**
   ```python
   # 同时测试多个NTC传感器
   # 一致性分析
   # 性能对比
   ```

3. **长期稳定性测试**
   ```python
   # 支持长时间测试（小时/天级别）
   # 数据压缩和存储优化
   # 定时采样
   ```

### 5. 错误处理和可靠性

1. **连接检测**
   ```python
   # 自动检测仪器连接状态
   # 断线重连机制
   # 连接超时处理
   ```

2. **数据验证**
   ```python
   # 数据合理性检查
   # 异常数据报警
   # 测试中断恢复
   ```

3. **日志系统**
   ```python
   # 详细的日志记录
   # 错误追踪
   # 性能监控
   ```

### 6. 性能优化

1. **数据采集优化**
   - 使用缓冲读取提高效率
   - 多线程数据采集和处理

2. **内存管理**
   - 大数据量时的流式处理
   - 数据压缩

### 7. 报告生成

1. **PDF报告**
   ```python
   # 使用reportlab生成PDF报告
   # 包含测试参数、曲线、统计信息
   # 自动生成测试结论
   ```

2. **Excel导出**
   ```python
   # 导出为Excel格式
   # 多工作表组织
   # 图表嵌入
   ```

## 常见问题

### Q1: 无法连接到仪器
**解决方案**:
1. 检查IP地址是否正确（LAN连接）
2. 检查USB连接和驱动（USB连接）
3. 确认仪器已开机并处于远程控制模式
4. 检查防火墙设置

### Q2: 采样率不稳定
**解决方案**:
1. 检查NPLC设置是否合适
2. 减少通道数或降低采样率
3. 使用硬件触发模式

### Q3: 数据异常或跳变
**解决方案**:
1. 检查传感器连接
2. 检查屏蔽和接地
3. 启用滤波功能
4. 检查NTC参数设置

### Q4: 温度转换不准确
**解决方案**:
1. 校准NTC的Beta值
2. 使用Steinhart-Hart方程替代Beta方程
3. 进行多点校准

## 技术细节

### NTC温度转换

当前使用Beta方程：
```
1/T = 1/T0 + (1/Beta) × ln(R/R0)
```

更精确的Steinhart-Hart方程（建议实现）：
```
1/T = A + B×ln(R) + C×(ln(R))³
```

### DAQM909A通道配置

- 通道编号：101-104（对应插槽1）
- 支持电阻、温度、电压等多种测量模式
- 同步采样能力：所有通道同时采样

## 后续开发计划

### 短期（1-2周）
- [ ] 添加GUI界面
- [ ] 实现Steinhart-Hart方程
- [ ] 添加PDF报告生成
- [ ] 完善错误处理

### 中期（1个月）
- [ ] 数据库集成
- [ ] 批量测试功能
- [ ] 温度循环测试
- [ ] 自动校准功能

### 长期（3个月+）
- [ ] Web界面
- [ ] 云端数据存储
- [ ] 机器学习数据分析
- [ ] 预测性维护

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件

## 许可证

本项目仅供学习和研究使用。

---

**最后更新**: 2024年
