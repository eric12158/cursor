# 角度规范化修复说明

## 问题描述

原始代码在计算角度差时，没有处理角度跨越 ±180° 的情况。例如：
- 当二维码角度从 179° 变成 -179° 时，实际只转动了 2°
- 但直接相减：179° - (-179°) = 358°，这是错误的

## 修复内容

### 1. 添加角度规范化函数

#### `normalize_angle_deg(angle_deg)`
- 将角度规范化到 [-180, 180] 度范围
- 处理角度超出范围的情况（如 181° -> -179°）

#### `normalize_angle_rad(angle_rad)`
- 将角度规范化到 [-π, π] 弧度范围
- 用于规范化弧度值

#### `angle_diff_deg(angle1_deg, angle2_deg)`
- 计算两个角度之间的最短角度差
- **关键功能**：处理角度跨越 ±180° 的情况
- 例如：179° 和 -179° 之间的差是 2°（而不是 358°）

### 2. 修改现有函数

#### `getDrAndDl(pA, pB)`
- 添加了角度规范化处理
- 规范化二维码角度和相对角度
- **修复**：添加了返回值 `return ddr2, dl`

#### `getPointB(pointB, dr, dl, c)`
- 规范化最终角度，确保在 [-π, π] 范围内

#### 主函数
- **修复**：使用 `angle_diff_deg()` 计算角度差，而不是直接相减
- **修复**：使用 `getDrAndDl()` 的返回值，而不是手动输入

## 测试结果

### 角度差计算测试
- ✓ 179° - (-179°) = -2°（绝对值 2°，正确）
- ✓ -179° - 179° = 2°（绝对值 2°，正确）
- ✓ 10° - 350° = 20°（正确）
- ✓ 350° - 10° = -20°（正确）

### 实际应用场景
当二维码角度从 179° 变成 -179° 时：
- 原始方法：179° - (-179°) = 358° ❌
- 修复后：angle_diff_deg(-179°, 179°) = 2° ✓

## 使用示例

```python
# 计算角度差（自动处理跨越±180°的情况）
angle_diff = angle_diff_deg(new_angle, old_angle)

# 在主函数中使用
c = angle_diff_deg(a[2], point[2])  # 二维码角度差
result = getPointB(point, dr, dl, c)
```

## 注意事项

1. **角度范围**：所有角度都规范化到 [-180, 180] 度范围
2. **角度差方向**：`angle_diff_deg(a, b)` 返回从 `b` 到 `a` 的最短角度差
3. **等价角度**：180° 和 -180° 在数学上等价，函数可能返回其中任意一个

## 代码改进总结

1. ✅ 添加角度规范化功能
2. ✅ 修复 `getDrAndDl` 函数缺少返回值的问题
3. ✅ 修复角度差计算，处理跨越 ±180° 的情况
4. ✅ 添加函数注释和说明

现在代码可以正确处理角度跨越 ±180° 的情况，避免了角度计算错误。
